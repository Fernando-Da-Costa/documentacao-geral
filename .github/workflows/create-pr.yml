name: Create Pull Request

on:
  push:
    branches: [feature/**]
  workflow_dispatch:

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create Pull Request
        uses: actions/github-script@v6
        with:
          script: |
            const { data: existingPRs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: `${context.repo.owner}:${context.ref.replace('refs/heads/', '')}`,
              base: 'main'
            });
            
            if (existingPRs.length === 0) {
              const pr = await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `feat: ${context.ref.replace('refs/heads/', '')}`,
                body: `## üìù Descri√ß√£o
                Pull Request autom√°tico criado a partir da branch \`${context.ref.replace('refs/heads/', '')}\`
                
                ## üîÑ Mudan√ßas
                - Altera√ß√µes autom√°ticas via CI/CD
                - Branch: \`${context.ref.replace('refs/heads/', '')}\`
                - Commit: \`${context.sha}\`
                
                ## ‚úÖ Checklist
                - [ ] C√≥digo revisado
                - [ ] Testes passando
                - [ ] Documenta√ß√£o atualizada
                
                ---
                *PR criado automaticamente pelo GitHub Actions*`,
                head: context.ref.replace('refs/heads/', ''),
                base: 'main'
              });
              
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.data.number,
                labels: ['automated', 'feature']
              });
              
              console.log(`Pull Request #${pr.data.number} created successfully!`);
            } else {
              console.log('Pull Request already exists for this branch');
            } 