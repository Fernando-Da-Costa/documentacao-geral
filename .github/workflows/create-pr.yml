name: Create Pull Request

on:
  push:
    branches: [feature/**]
  workflow_dispatch:

jobs:
  create-pr-to-develop:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create Pull Request
        uses: actions/github-script@v6
        with:
          script: |
            const branchName = context.ref.replace('refs/heads/', '');
            
            // Verificar se jÃ¡ existe um PR para esta branch
            const { data: existingPRs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: `${context.repo.owner}:${branchName}`,
              base: 'develop'
            });
            
            if (existingPRs.length === 0) {
              // Obter informaÃ§Ãµes do Ãºltimo commit
              const { data: commits } = await github.rest.repos.listCommits({
                owner: context.repo.owner,
                repo: context.repo.repo,
                sha: branchName,
                per_page: 5
              });
              
              const commitList = commits.map(commit => 
                `- \`${commit.sha.substring(0, 7)}\` ${commit.commit.message.split('\n')[0]}`
              ).join('\n');
              
              const pr = await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `feat: ${branchName}`,
                body: `## ğŸ“ DescriÃ§Ã£o
                Pull Request automÃ¡tico criado a partir da branch \`${branchName}\`
                
                ## ğŸ”„ MudanÃ§as
                - CriaÃ§Ã£o de documentaÃ§Ã£o.
                - Branch: \`${branchName}\`
                - Commit: \`${context.sha.substring(0, 7)}\`
                - Autor: \`${context.actor}\`
                
                ## ğŸ“Š Commits IncluÃ­dos
                ${commitList}
                ## âœ… Checklist
                - [ ] CÃ³digo revisado
                - [ ] Testes passando
                - [ ] DocumentaÃ§Ã£o atualizada
                - [ ] Sem conflitos de merge
                
                ## ğŸ·ï¸ Labels
                - \`automated\`
                - \`feature\`
                
                ## ğŸ”— PrÃ³ximos Passos
                - ApÃ³s aprovaÃ§Ã£o, este PR serÃ¡ mergeado para \`develop\`
                - Um PR automÃ¡tico de \`develop\` para \`main\` serÃ¡ criado automaticamente
                
                ---
                *PR criado automaticamente pelo GitHub Actions*`,
                head: branchName,
                base: 'develop'
              });
              
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.data.number,
                labels: ['automated', 'feature']
              });
              
              console.log(`âœ… Pull Request #${pr.data.number} criado com sucesso!`);
              console.log(`ğŸ“‹ Branch: ${branchName} â†’ develop`);
            } else {
              console.log('âš ï¸ Pull Request jÃ¡ existe para esta branch');
              console.log(`ğŸ“‹ PR existente: #${existingPRs[0].number}`);
            } 