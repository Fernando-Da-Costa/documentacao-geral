name: Create PR from Develop to Main

on:
  pull_request:
    types: [closed]
    branches: [develop]

jobs:
  create-main-pr:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create PR to Main
        uses: actions/github-script@v6
        with:
          script: |
            // Verificar se jÃ¡ existe um PR da develop para main
            const { data: existingPRs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: 'develop',
              base: 'main'
            });
            
            if (existingPRs.length === 0) {
              const pr = await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ðŸš€ Release: Deploy to Production`,
                body: `## ðŸš€ Release para ProduÃ§Ã£o
                
                ### ðŸ“‹ Resumo
                - Branch: \`develop\` â†’ \`main\`
                - Trigger: PR mergeado na develop
                - Commit: \`${context.sha}\`
                
                ### ðŸ”„ MudanÃ§as IncluÃ­das
                - Features aprovadas e testadas na develop
                - ValidaÃ§Ãµes passaram com sucesso
                - Pronto para deploy em produÃ§Ã£o
                
                ### âœ… Checklist de Release
                - [ ] Todas as features testadas
                - [ ] ValidaÃ§Ãµes passando
                - [ ] DocumentaÃ§Ã£o atualizada
                - [ ] Aprovado para produÃ§Ã£o
                
                ---
                *PR criado automaticamente apÃ³s merge na develop*`,
                head: 'develop',
                base: 'main'
              });
              
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.data.number,
                labels: ['release', 'production', 'automated']
              });
              
              console.log(`Release PR #${pr.data.number} created successfully!`);
            } else {
              console.log('Release PR already exists from develop to main');
            } 